<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DEMO</title>
    <link rel="stylesheet" href="/static/d3-tip.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-light  navbar-expand-lg" style="background-color: #523F78; height: 63px;">
        <div class="container">
            <a href="/" class="navbar-brand text-white mr-auto">Data Mashup Application</a>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white-50" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span>Search</span>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="search_1">Search specific area</a>
                        <a class="dropdown-item" href="search_2">Search specific year</a>
                    </div>
                </li>
                <li class="nav-item"><a class="nav-link  text-white-50 mr-lg-3"><span class="mosh">Full List</span></a></li>
                <li class="nav-item"><a class="nav-link  text-white-50 mr-lg-3"><span class="mosh" id="population">Population</span></a></li>
            </ul>
        </div>
    </nav>
    <div id="search-area">
        <div class="container" style="height: 100%">
        <form action="#" style="padding-left: 400px">
            <div class="input-group input-group-sm mb-3 col-5 pt-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="form-state">State</span>
                </div>
                <select  id= 'form-state-input' type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
                    <option value="AK">Alaska</option>
                    <option value="AL">Alabama</option>
                    <option value="AR">Arkansas</option>
                    <option value="AS">American Samoa</option>
                    <option value="AZ">Arizona</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DC">District of Columbia</option>
                    <option value="DE">Delaware</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="GU">Guam</option>
                    <option value="HI">Hawaii</option>
                    <option value="IA">Iowa</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MD">Maryland</option>
                    <option value="ME">Maine</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MO">Missouri</option>
                    <option value="MP">Northern Mariana Islands</option>
                    <option value="MS">Mississippi</option>
                    <option value="MT">Montana</option>
                    <option value="NA">National</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="NE">Nebraska</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NV">Nevada</option>
                    <option value="NY">New York</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="PR">Puerto Rico</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VA">Virginia</option>
                    <option value="VI">Virgin Islands</option>
                    <option value="VT">Vermont</option>
                    <option value="WA">Washington</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WV">West Virginia</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>
            <div class="input-group input-group-sm mb-3 col-5">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="form-date-from">From</span>
                </div>
                <input type="date" class="form-control" id="form-date-from-input" aria-label="Small" aria-describedby="inputGroup-sizing-sm" min="2013-01-01" max="2017-05-03">
            </div>
            <div class="input-group input-group-sm mb-3 col-5">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="form-date-to" style="width: 50px">To</span>
                </div>
                <input type="date" class="form-control" id="form-date-to-input" aria-label="Small" aria-describedby="inputGroup-sizing-sm" min="2013-01-01" max="2017-05-03">
            </div>
            <div class="row col-5">
                <div style="margin-left: 200px">
                    <button type="button" class="btn btn-primary" id="submit-button">Submit</button>
                </div>
            </div>
        </form>
        </div>
    </div>
    <div id="main">
        <div class="container">
            <!-- Main content here................................... -->
            <script type='text/javascript' src='http://dataviz.worldbank.org/javascripts/api/viz_v1.js'></script>
            <div class='tableauPlaceholder col-md-12'>
                <object class='tableauViz' width='1080' height='1067' style='display:none;'>
                    <param name='host_url' value='http%3A%2F%2Fdataviz.worldbank.org%2F' />
                    <param name='embed_code_version' value='3' />
                    <param name='site_root' value='&#47;t&#47;HealthStats' />
                    <param name='name' value='HealthStatsPopulationDashboardbyCountryandGroup-v3_Jun2017&#47;HStatsDashboardbyCountryandGroup' />
                    <param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='display_count' value='no' />
                </object>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="static/barChart.js" type="text/javascript"></script>
    <script src="/static/pieChart.js" type="text/javascript"></script>
    <script src="/static/lineChart.js" type="text/javascript"></script>
    <script type="text/javascript" src="/static/d3-tip.js" charset="utf-8"></script>
    <script src="/static/makeTable.js"></script>
        <script>
            $('#main .container').html('');
            $('.mosh').click(function() {
                $('#main .container').html('');
                $('.mosh').css('text-decoration', 'none');
                $(this).css('text-decoration', 'underline');
                if ($(this).attr('id') === 'population') {
                    var h = $.ajax({
                    url: '/' + $(this).attr('id'),
                    type: 'get'
                    }).done(function(data) {
                        $('#search-area').remove();
                        $('#main .container').append(data);
                    }).fail(function(xhr, status) {
                        $('#exampleModal').modal('show');
                    })
                }
                if ($(this).attr('id') === 'about') {
                    var h = $.ajax({
                    url: '/' + $(this).attr('id'),
                    type: 'get'
                    }).done(function(data) {
                        pieChart(data);
                    }).fail(function(xhr, status) {
                        $('#exampleModal').modal('show');
                    })
                }
            });

            d3.select('#main').select('.container')
                .append('div')
                .attr('style', 'display:none;')
                .attr('id', 'loading')
                .append('img')
                .attr('src', 'static/timg.gif')
                .attr('class', 'img-responsive');

        $('#submit-button').click(function() {
            $('#main').html('');
            $('#main').append('<div class="container"></div>');
            var search_state = $('#form-state-input').val();
            var search_year_from = $('#form-date-from-input').val();
            var search_year_to = $('#form-date-to-input').val();
            if (search_year_from > search_year_to) {
                alert('year from > year to');
                return
            };
            d3.select('#main').select('.container')
                .append('div')
                .attr('id', 'loading')
                .append('img')
                .attr('src', 'static/timg.gif')
                .attr('class', 'img-responsive');
            {#alert('search query: ' + search_state + ', from' + search_year_from + ' to ' + search_year_to);#}
            var jqxhr_1 = $.ajax({
                url: '/graph%3Farea%3D' + search_state + '%26timefrom%3D' + search_year_from + '%26timeto%3D' + search_year_to,
                type: 'get'
            }).done(function(data) {
                $('#loading').hide(0);
                barChart(data);
            }).fail(function(xhr, status) {
                $('#exampleModal').modal('show');
            });
            var jqxhr_2 = $.ajax({
                url: '/search%3Farea%3D' + search_state + '%26timefrom%3D' + search_year_from + '%26timeto%3D' + search_year_to,
                type: 'get'
            }).done(function(data) {
                console.log('get search done.');
                console.log(data);
                for (var key in data){
                    var area = key;
                }
                $('#main').append('    <div class="container" style="margin-left:110px;padding-bottom:120px;padding-top:50px">\n' +
                    '        <table id="table" data-height="460">\n' +
                    '            <thead>\n' +
                    '                <tr>\n' +
                    '                    <th data-field="incident_id">ID</th>\n' +
                    '                    <th data-field="date">Date</th>\n' +
                    '                    <th data-field="n_injured">N_injured</th>\n' +
                    '                    <th data-field="n_killed">N_killed</th>\n' +
                    '                </tr>\n' +
                    '            </thead>\n' +
                    '        </table>\n' +
                    '    </div>');
                make(key, data);
            }).fail(function(xhr, status) {
                $('#exampleModal').modal('show');
            })
        })
    </script>
</body>
</html>